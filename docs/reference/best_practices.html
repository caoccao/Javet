<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Javet Performance" href="performance.html" /><link rel="prev" title="Load and Unload" href="load_and_unload.html" />

    <link rel="shortcut icon" href="../_static/logo.ico"/><meta name="generator" content="sphinx-3.5.4, furo 2021.04.11.beta34"/>
        <title>Best Practices - Javet 0.9.12 documentation</title>
      <link rel="stylesheet" href="../_static/styles/furo.css?digest=59ab60ac09ea94ccfe6deddff6d715cce948a6fc">
    <link rel="stylesheet" href="../_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <link rel="stylesheet" href="../_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Javet 0.9.12 documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Javet 0.9.12 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorial/index.html">Tutorial</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../tutorial/basic/index.html">Basic</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/basic/installation.html">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/basic/hello_javet.html">Hello Javet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/basic/engine_pool.html">Javet Engine Pool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/basic/interception.html">Interception</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/basic/javet_shell.html">Javet Shell</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/basic/node_js_mode_and_v8_mode.html">Node.js Mode and V8 Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/basic/spring_integration.html">Spring Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/basic/polyfill.html">Polyfill</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../tutorial/advanced/index.html">Advanced</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/advanced/object_converter.html">Object Converter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/advanced/java_and_javascript_interop.html">Java and JavaScript Interop</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/advanced/interact_with_node_js.html">Interact with Node.js</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Reference</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="v8_collection.html">V8 Collection</a></li>
<li class="toctree-l2"><a class="reference internal" href="v8_function.html">V8 Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="v8_promise.html">V8 Promise</a></li>
<li class="toctree-l2"><a class="reference internal" href="modularization.html">Modularization</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory_management.html">Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="lock.html">Know the Lock</a></li>
<li class="toctree-l2"><a class="reference internal" href="termination.html">Termination</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="load_and_unload.html">Load and Unload</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="performance.html">Javet Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="error_codes.html">Error Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="todo_list.html">TODO List</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../release_notes/index.html">Release Notes</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../release_notes/release_notes_0_9.html">Release Notes 0.9.x</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release_notes/release_notes_0_8.html">Release Notes 0.8.x</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release_notes/release_notes_0_7.html">Release Notes 0.7.x</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../faq/index.html">FAQ</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label for="toctree-checkbox-6"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../faq/what_is_the_motivation.html">What is the Motivation?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/history_with_j2v8.html">History with J2V8</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/can_javet_support_mac.html">Can Javet Support Mac?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/can_javet_support_legacy_linux.html">Can Javet Support Legacy Linux?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/how_to_think_in_javet.html">How to Think in Javet?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/where_are_es6_api_in_v8_mode.html">Where are ES6 API in V8 Mode?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/a_dynamic_link_library_dll_initialization_routine_failed.html">A dynamic link library (DLL) initialization routine failed</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/can_i_debug_javet_in_chrome_dev_tools.html">Can I Debug Javet in Chrome DevTools?</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../development/index.html">Development</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label for="toctree-checkbox-7"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../development/tools.html">Development Tools</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../development/build.html">Build Javet</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label for="toctree-checkbox-8"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../development/build_javet_with_docker.html">Build Javet with Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/build_javet_with_pre_built_binaries.html">Build Javet with Pre-built Binaries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/build_javet_from_scratch.html">Build Javet from Scratch</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../development/test.html">Test Javet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/design.html">Javet Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/debug_with_chrome_developer_tools.html">Debug with Chrome Developer Tools</a></li>
</ul>
</li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="best-practices">
<h1>Best Practices<a class="headerlink" href="#best-practices" title="Permalink to this headline">¶</a></h1>
<div class="section" id="thread-engine-and-pool">
<h2>Thread, Engine and Pool<a class="headerlink" href="#thread-engine-and-pool" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>Always get 1 Javet engine from the pool in 1 thread.</p></li>
<li><p>If multiple context is required in 1 thread, there are 2 options.</p>
<blockquote>
<div><ul class="simple">
<li><p>Call <code class="docutils literal notranslate"><span class="pre">resetContext()</span></code> between context switch.</p></li>
<li><p>Obtain multiple V8Runtime instances.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Do not pass Javet engine to other threads.</p></li>
<li><p>Always return Javet engine to pool in the end via try-with-resource or calling <code class="docutils literal notranslate"><span class="pre">close()</span></code> explicitly.</p></li>
<li><p>Subclass Javet engine pool and Javet engine to complete your customization. Indeed, they are open to full customization.</p></li>
</ul>
</div>
<div class="section" id="resource-management">
<h2>Resource Management<a class="headerlink" href="#resource-management" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>Dangling V8 objects will be forced to be recycled by Javet under the following scenarios and corresponding log will reflect that. Keeping an eye on the log helps address memory leak issues in the early stage.</p>
<blockquote>
<div><ul class="simple">
<li><p>Engine is closed.</p></li>
<li><p>Pool is closed.</p></li>
<li><p>Context is reset.</p></li>
<li><p>Isolate is reset.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Always apply <code class="docutils literal notranslate"><span class="pre">try-with-resource</span></code> to Javet objects regardless of primitive or reference if they are not returned to Javet.</p></li>
<li><p>Always prohibit calling <code class="docutils literal notranslate"><span class="pre">close()</span></code> of Javet objects if they will be returned to Javet.</p></li>
<li><p>If the lifecycle of V8 objects is uncertain, calling <code class="docutils literal notranslate"><span class="pre">setWeak()</span></code> is the only way so that calling <code class="docutils literal notranslate"><span class="pre">close()</span></code> is no longer required. Be careful, calling <code class="docutils literal notranslate"><span class="pre">close()</span></code> after calling <code class="docutils literal notranslate"><span class="pre">setWeak()</span></code> may lead to V8 core dump immediately.</p></li>
<li><p>In performance sensitive scenarios, please explicitly acquire <code class="docutils literal notranslate"><span class="pre">V8Locker</span></code>.</p></li>
</ul>
</div>
<div class="section" id="security">
<h2>Security<a class="headerlink" href="#security" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Malicious scripts are recommended to be executed in V8 mode or in <code class="docutils literal notranslate"><span class="pre">vm</span></code> module in Node.js mode.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">eval</span></code> can be disabled in Javet.</p></li>
<li><p>V8 0-day vulnerable issues most likely impact Node.js because the embedded V8 in Node.js is very old. It's recommended to use the V8 mode to minimize the risk.</p></li>
</ul>
</div>
<div class="section" id="node-js">
<h2>Node.js<a class="headerlink" href="#node-js" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Modularize the code as much as possible so that performance is maximized.</p></li>
<li><p>Always register unhandled rejection event.</p></li>
<li><p>In <strong>non-module</strong> mode (similar to V8 in web browser), always put launch script in a dedicated folder whose parent folder contains <code class="docutils literal notranslate"><span class="pre">node_modules</span></code> and avoid <code class="docutils literal notranslate"><span class="pre">require</span></code> modules in the same folder.</p></li>
<li><p>In <strong>module</strong> mode (similar to V8 in Node.js), be aware that the execution result is a promise and the behavior is different from native Node.js runtime behavior unless <code class="docutils literal notranslate"><span class="pre">await()</span></code> is called.</p></li>
</ul>
</div>
</div>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="performance.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Javet Performance</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="load_and_unload.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Load and Unload</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2021. caoccao.com Sam Cao
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="../_sources/reference/best_practices.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Best Practices</a><ul>
<li><a class="reference internal" href="#thread-engine-and-pool">Thread, Engine and Pool</a></li>
<li><a class="reference internal" href="#resource-management">Resource Management</a></li>
<li><a class="reference internal" href="#security">Security</a></li>
<li><a class="reference internal" href="#node-js">Node.js</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/tabs.js"></script>
    <script src="../_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>